<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Career Guidance</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
        }

        .navbar {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
        }

        .navbar-brand i {
            font-size: 1.5rem;
        }

        .navbar-user {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .logout-btn {
            padding: 0.5rem 1rem;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: #dc2626;
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border);
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: var(--text-light);
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            margin-bottom: -2px;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Chat Styles */
        .chat-container {
            background: var(--surface);
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            height: 70vh;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.75rem;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .message.user .message-avatar {
            background: var(--border);
            color: var(--text);
        }

        .message-content {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 12px;
        }

        .message.bot .message-content {
            background: var(--bg);
        }

        .message.user .message-content {
            background: var(--primary);
            color: white;
        }

        .chat-input {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 0.75rem;
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.9375rem;
        }

        .chat-input button {
            padding: 0.75rem 1.5rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chat-input button:hover {
            background: var(--primary-dark);
        }

        /* Recommendations Styles */
        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .recommendation-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }

        .recommendation-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .recommendation-header {
            display: flex;
            align-items: start;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .recommendation-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
        }

        .recommendation-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .recommendation-subtitle {
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .recommendation-description {
            color: var(--text-light);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .recommendation-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .skill-tag {
            padding: 0.25rem 0.75rem;
            background: var(--bg);
            border-radius: 20px;
            font-size: 0.8125rem;
            color: var(--text);
        }

        /* Mentors/Jobs Grid */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }

        .card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .card-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .card-subtitle {
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .card-content {
            color: var(--text-light);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .card-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .card-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-btn {
            width: 100%;
            padding: 0.75rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9375rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .card-btn:hover {
            background: var(--primary-dark);
        }

        .filters {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            background: var(--surface);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }

            .container {
                padding: 0 1rem;
            }

            .tabs {
                overflow-x: auto;
            }

            .recommendations-grid,
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">
            <i class="fas fa-briefcase"></i>
            <span>Career Guide</span>
        </div>
        <div class="navbar-user">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">?</div>
                <span id="userName"></span>
            </div>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </nav>

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('chat')">
                <i class="fas fa-comments"></i> Chat
            </button>
            <button class="tab" onclick="switchTab('recommendations')">
                <i class="fas fa-chart-line"></i> Recommendations
            </button>
            <button class="tab" onclick="switchTab('mentors')">
                <i class="fas fa-users"></i> Mentors
            </button>
            <button class="tab" onclick="switchTab('jobs')">
                <i class="fas fa-briefcase"></i> Jobs
            </button>
        </div>

        <!-- Chat Tab -->
        <div id="chat-tab" class="tab-content active">
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="message bot">
                        <div class="message-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            Hello! I'm your career guidance assistant. How can I help you with your career journey today?
                        </div>
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="chatInput" placeholder="Ask me about careers, skills, or opportunities..." onkeypress="handleKeyPress(event)">
                    <button onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i> Send
                    </button>
                </div>
            </div>
        </div>

        <!-- Recommendations Tab -->
        <div id="recommendations-tab" class="tab-content">
            <div class="recommendations-grid" id="recommendationsGrid">
                <div class="empty-state">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading recommendations...</p>
                </div>
            </div>
        </div>

        <!-- Mentors Tab -->
        <div id="mentors-tab" class="tab-content">
            <div class="filters">
                <button class="filter-btn active" onclick="filterMentors('all')">All</button>
                <button class="filter-btn" onclick="filterMentors('Technology')">Technology</button>
                <button class="filter-btn" onclick="filterMentors('Finance')">Finance</button>
                <button class="filter-btn" onclick="filterMentors('Healthcare')">Healthcare</button>
                <button class="filter-btn" onclick="filterMentors('Education')">Education</button>
            </div>
            <div class="grid" id="mentorsGrid">
                <div class="empty-state">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading mentors...</p>
                </div>
            </div>
        </div>

        <!-- Jobs Tab -->
        <div id="jobs-tab" class="tab-content">
            <div class="filters">
                <button class="filter-btn active" onclick="filterJobs('all')">All</button>
                <button class="filter-btn" onclick="filterJobs('Technology')">Technology</button>
                <button class="filter-btn" onclick="filterJobs('Finance')">Finance</button>
                <button class="filter-btn" onclick="filterJobs('Healthcare')">Healthcare</button>
                <button class="filter-btn" onclick="filterJobs('Education')">Education</button>
            </div>
            <div class="grid" id="jobsGrid">
                <div class="empty-state">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading jobs...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let currentFilter = {mentors: 'all', jobs: 'all'};

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
            loadRecommendations();
            loadMentors();
            loadJobs();
        });

        function loadUserInfo() {
            fetch('/api/current-user')
                .then(res => res.json())
                .then(data => {
                    currentUser = data;
                    document.getElementById('userName').textContent = data.name || data.username;
                    document.getElementById('userAvatar').textContent = (data.name || data.username).charAt(0).toUpperCase();
                })
                .catch(err => console.error('Error loading user:', err));
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            // Add user message
            const messagesDiv = document.getElementById('chatMessages');
            messagesDiv.innerHTML += `
                <div class="message user">
                    <div class="message-avatar">${currentUser ? currentUser.name.charAt(0).toUpperCase() : 'U'}</div>
                    <div class="message-content">${message}</div>
                </div>
            `;

            input.value = '';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            // Send to API
            fetch('/api/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({message: message})
            })
            .then(res => res.json())
            .then(data => {
                messagesDiv.innerHTML += `
                    <div class="message bot">
                        <div class="message-avatar"><i class="fas fa-robot"></i></div>
                        <div class="message-content">${data.response || 'Sorry, I could not process your request.'}</div>
                    </div>
                `;
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            })
            .catch(err => {
                console.error('Chat error:', err);
                messagesDiv.innerHTML += `
                    <div class="message bot">
                        <div class="message-avatar"><i class="fas fa-robot"></i></div>
                        <div class="message-content">Sorry, I'm having trouble connecting right now. Please try again.</div>
                    </div>
                `;
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            });
        }

        function loadRecommendations() {
            fetch('/api/recommendations')
                .then(res => res.json())
                .then(data => {
                    const grid = document.getElementById('recommendationsGrid');
                    if (data.recommendations && data.recommendations.length > 0) {
                        grid.innerHTML = data.recommendations.map(rec => `
                            <div class="recommendation-card">
                                <div class="recommendation-header">
                                    <div class="recommendation-icon">
                                        <i class="fas fa-lightbulb"></i>
                                    </div>
                                    <div>
                                        <div class="recommendation-title">${rec.career_path || rec.title}</div>
                                        <div class="recommendation-subtitle">Match: ${rec.match_score || '85'}%</div>
                                    </div>
                                </div>
                                <div class="recommendation-description">${rec.description || rec.reasoning || 'This career path aligns with your skills and interests.'}</div>
                                ${rec.skills ? `
                                    <div class="recommendation-skills">
                                        ${rec.skills.map(skill => `<span class="skill-tag">${skill}</span>`).join('')}
                                    </div>
                                ` : ''}
                            </div>
                        `).join('');
                    } else {
                        grid.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-chart-line"></i>
                                <p>No recommendations available yet. Complete your profile to get personalized suggestions!</p>
                            </div>
                        `;
                    }
                })
                .catch(err => {
                    console.error('Error loading recommendations:', err);
                    document.getElementById('recommendationsGrid').innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-exclamation-circle"></i>
                            <p>Error loading recommendations. Please try again later.</p>
                        </div>
                    `;
                });
        }

        function loadMentors(industry = 'all') {
            const url = industry === 'all' ? '/api/mentors' : `/api/mentors?industry=${industry}`;
            fetch(url)
                .then(res => res.json())
                .then(data => {
                    const grid = document.getElementById('mentorsGrid');
                    if (data.mentors && data.mentors.length > 0) {
                        grid.innerHTML = data.mentors.map(mentor => `
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-avatar">${mentor.name.charAt(0)}</div>
                                    <div>
                                        <div class="card-title">${mentor.name}</div>
                                        <div class="card-subtitle">${mentor.title}</div>
                                    </div>
                                </div>
                                <div class="card-content">${mentor.bio || mentor.description}</div>
                                <div class="card-meta">
                                    <div class="card-meta-item">
                                        <i class="fas fa-briefcase"></i>
                                        ${mentor.industry}
                                    </div>
                                    <div class="card-meta-item">
                                        <i class="fas fa-clock"></i>
                                        ${mentor.years_experience || mentor.experience} years
                                    </div>
                                </div>
                                <button class="card-btn" onclick="connectMentor('${mentor._id}')">
                                    <i class="fas fa-user-plus"></i> Connect
                                </button>
                            </div>
                        `).join('');
                    } else {
                        grid.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-users"></i>
                                <p>No mentors found. Try a different filter.</p>
                            </div>
                        `;
                    }
                })
                .catch(err => console.error('Error loading mentors:', err));
        }

        function loadJobs(industry = 'all') {
            const url = industry === 'all' ? '/api/jobs' : `/api/jobs?industry=${industry}`;
            fetch(url)
                .then(res => res.json())
                .then(data => {
                    const grid = document.getElementById('jobsGrid');
                    if (data.jobs && data.jobs.length > 0) {
                        grid.innerHTML = data.jobs.map(job => `
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-avatar">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <div>
                                        <div class="card-title">${job.title}</div>
                                        <div class="card-subtitle">${job.company}</div>
                                    </div>
                                </div>
                                <div class="card-content">${job.description}</div>
                                <div class="card-meta">
                                    <div class="card-meta-item">
                                        <i class="fas fa-map-marker-alt"></i>
                                        ${job.location}
                                    </div>
                                    <div class="card-meta-item">
                                        <i class="fas fa-briefcase"></i>
                                        ${job.job_type || 'Full-time'}
                                    </div>
                                    ${job.salary ? `
                                        <div class="card-meta-item">
                                            <i class="fas fa-dollar-sign"></i>
                                            ${job.salary}
                                        </div>
                                    ` : ''}
                                </div>
                                <button class="card-btn" onclick="applyJob('${job._id}')">
                                    <i class="fas fa-paper-plane"></i> Apply Now
                                </button>
                            </div>
                        `).join('');
                    } else {
                        grid.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-briefcase"></i>
                                <p>No jobs found. Try a different filter.</p>
                            </div>
                        `;
                    }
                })
                .catch(err => console.error('Error loading jobs:', err));
        }

        function filterMentors(industry) {
            currentFilter.mentors = industry;
            document.querySelectorAll('#mentors-tab .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            loadMentors(industry);
        }

        function filterJobs(industry) {
            currentFilter.jobs = industry;
            document.querySelectorAll('#jobs-tab .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            loadJobs(industry);
        }

        function connectMentor(mentorId) {
            fetch('/api/mentor-connection', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({mentor_id: mentorId, message: 'I would like to connect with you.'})
            })
            .then(res => res.json())
            .then(data => {
                alert(data.message || 'Connection request sent!');
            })
            .catch(err => {
                console.error('Error connecting:', err);
                alert('Failed to send connection request. Please try again.');
            });
        }

        function applyJob(jobId) {
            alert('Application feature coming soon! Job ID: ' + jobId);
        }

        function logout() {
            window.location.href = '/logout';
        }
    </script>
</body>
</html>
